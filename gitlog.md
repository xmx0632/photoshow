# Git 提交日志

## 未提交更改

- feat(env): 将缓存过期时间(CACHE_TTL)改为可配置的环境变量
- refactor(ui): 移除管理页面中的“创建备份”功能
- refactor(api): 删除备份功能的后端 API 和相关实现
- feat(limit): 添加每日图片生成数量限制功能
- feat(cache): 使用 Redis 存储每日图片生成次数，并设置 2 天的 TTL 自动清理
- fix(cache): 优化Redis缓存更新机制，添加重试机制和详细日志
- refactor(upload): 重构图片上传API，移除重复代码并使用辅助函数提高可维护性
- fix(model): 优化图片数据模型，只保留imageUrl属性避免重复存储相同URL
- fix(client): 移除客户端对/api/images/cache接口的多余调用，由服务端自动处理缓存更新

- feat(cache): 实现图片增量缓存更新，新增和删除图片时自动更新缓存而非全量同步
- fix(cache): 修复 Redis 缓存服务中图片对象无效导致的错误
- fix(config): 修复缓存类型配置未正确加载的问题
- fix(upload): 修复图片上传后缓存更新错误，正确处理上传返回结果
- fix(ui): 修复浏览图库中图片不显示的问题，正确转换缓存数据格式
- refactor(model): 实现统一的图片数据模型，避免多处数据转换，提高代码可维护性

- perf(cache): 添加内存级缓存和合并查询功能，显著提高缓存访问速度
- perf(redis): 优化 Redis 连接管理，避免重复创建连接并添加超时控制
- perf(cache): 增加缓存过期时间从 5 分钟到 30 分钟，减少缓存刷新频率
- perf(cache): 增强缓存同步性能测量，详细记录各步骤执行时间
- perf(cache): 优化缓存访问策略，改为直接返回缓存数据并后台异步刷新
- fix(ui): 修改图片生成成功后的链接，将“管理所有图片”替换为“浏览图库”
- feat(security): 修改浏览图库页面，移除删除按钮，只允许下载图片
- feat(auth): 修复管理员登录状态同步问题，将退出按钮移至导航栏
- fix(ui): 修复登录后顶部菜单不立即更新的问题，实现自定义事件通知机制
- fix(auth): 修复isAuthenticated命名冲突导致的运行时错误
- docs(design): 修改设计文档，优化为MVP快速开发版本，使用NextJS和Tailwind CSS，集成Gemini API
- docs(prompt): 完善开发提示词文档，为各个迭代阶段添加详细的开发指南
- feat(init): 初始Next.js项目，配置Tailwind CSS和项目结构
- feat(layout): 创建基础布局组件，包括导航栏和页脚
- feat(api): 集成Gemini API，实现图片生成功能
- feat(components): 开发图片生成表单和图片浏览组件
- feat(pages): 创建首页、图片生成页面和图片浏览页面
- fix(api): 修复Gemini API连接问题，添加超时处理和错误诊断，使用替代方案实现图片生成功能
- fix(ui): 修复输入框文字颜色问题，确保文字在各种主题模式下可见
- feat(env): 添加dotenv支持，优化环境变量加载方式，提供环境变量配置示例
- feat(analytics): 集成Vercel Web Analytics功能，添加访问统计和分析能力
- feat(storage): 集成Cloudflare R2云存储，实现图片上传和持久化存储
- feat(api): 添加图片上传API路由，支持Base64和文件上传方式
- feat(components): 开发图片上传组件，集成到图片生成表单
- feat(metadata): 实现图片元数据管理，支持标签和分类功能
- feat(pages): 添加图片管理页面，支持标签管理和存储监控
- feat(backup): 实现数据备份和恢复功能，确保元数据安全
- feat(nav): 更新导航栏，添加图片管理页面入口
- fix(ui): 修复图片生成后无法显示的问题，调整前端组件与API响应字段匹配
- fix(storage): 修复图片在浏览图库和图片管理中不显示的问题，统一本地存储和云存储的数据结构
- fix(api): 修复图片上传API错误，添加手动解析JSON请求体的逻辑，统一字段名称
- feat(storage): 使用 IndexedDB 替代 localStorage 保存图片，支持更大存储空间并自动清理旧图片
- fix(ui): 修复浏览图库中显示重复图片的问题，优先显示本地缓存图片
- feat(cache): 实现缓存系统的灵活切换，支持文件系统和 Redis 两种缓存方式
- feat(admin): 添加缓存配置组件，允许管理员在界面中切换缓存类型
- feat(api): 添加缓存类型配置 API，支持获取和设置缓存类型
- docs(env): 更新环境变量配置示例，添加缓存和 Redis 相关配置
- fix(storage): 修复先上传图片再保存导致浏览图库中重复显示的问题
- fix(storage): 修复 IndexedDB 中同一张图片使用不同 ID 重复保存的问题
- feat(cache): 添加服务端图片列表缓存功能，加速页面响应速度并确保数据一致性
- fix(cache): 修复服务端缓存使用 IndexedDB 导致的错误，优化了缓存同步逻辑
- fix(cache): 全面修复服务端缓存问题，增强了环境检测和错误处理，确保图片正确显示
- fix(images): 修复图片管理页面无法显示云存储图片的问题，使用缓存 API 获取图片
- fix(delete): 优化删除图片逻辑，确保同时删除本地和云存储中的图片，并更新缓存
- fix(ui): 修复图片管理页面图片无法显示和提示词不正确的问题，兼容不同数据源的图片格式
- fix(ui): 修复提示词输入框文本颜色问题，添加浅色模式下的文本颜色样式
- fix(tags): 修复图片管理页面添加标签失败的问题，改进图片ID处理逻辑
- fix(ui): 修复添加标签输入框文本颜色问题，增强输入框可读性
- fix(metadata): 添加元数据 API 和自动创建元数据功能，解决标签管理依赖问题
- fix(id): 修复 IndexedDB 和元数据中图片ID不一致的问题
- feat(database): 添加 Supabase 数据库集成，实现图片和标签数据的云存储功能
- refactor(api): 完全移除 metadata.json 引用，将所有标签和元数据操作重定向到 Supabase
- fix(manage): 修改图片管理页面，直接使用 Supabase API 添加和删除标签，不再依赖本地元数据文件
